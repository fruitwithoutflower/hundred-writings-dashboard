// Day 계산 함수
function calculateDay(dateString) {
  const postDate = new Date(dateString);
  const startDate = new Date('2025-09-23'); // ✅ 2025년으로 수정
  return Math.floor((postDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
}

// 연속 기록 계산 함수에서
function calculateStreak(posts, author) {
  const authorPosts = posts.filter(post => 
    post.properties.작성자?.select?.name === author
  );
  
  if (authorPosts.length === 0) return 0;
  
  const sortedDates = authorPosts
    .map(post => post.properties.날짜?.date?.start)
    .filter(date => date)
    .sort()
    .reverse();
  
  if (sortedDates.length === 0) return 0;
  
  let streak = 0;
  const today = new Date();
  const startDate = new Date('2025-09-23'); // ✅ 2025년으로 수정
  
  for (let i = 0; i < 100; i++) {
    const checkDate = new Date(today);
    checkDate.setDate(today.getDate() - i);
    
    if (checkDate < startDate) break;
    
    const dateString = checkDate.toISOString().split('T')[0];
    
    if (sortedDates.includes(dateString)) {
      streak++;
    } else {
      break;
    }
  }
  
  return streak;
}

// 메인 함수에서
async function updateDashboardData() {
  try {
    // 현재 일차 계산
    const today = new Date();
    const startDate = new Date('2025-09-23'); // ✅ 2025년으로 수정
    const currentDay = Math.floor((today - startDate) / (1000 * 60 * 60 * 24)) + 1;
    const daysClamped = Math.min(Math.max(currentDay, 1), 100);
    
    // ... (중간 생략)
    
    // 메타 데이터
    lastUpdated: new Date().toISOString(),
    projectInfo: {
      startDate: '2025-09-23', // ✅ 2025년으로 수정
      endDate: '2025-12-31',   // ✅ 2025년으로 수정
      totalDays: 100,
    }
  }
}
